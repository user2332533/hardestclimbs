<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athlete Profile - Hardest Climbs in the World</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 id="athlete-name">Loading...</h1>
            <p class="subtitle">Athlete Profile</p>
        </header>
        
        <nav>
            <a href="/">Home</a>
            <a href="/sport">Sport Climbs</a>
            <a href="/boulder">Boulders</a>
            <a href="/athletes">Athletes</a>
            <a href="/export">üì• Export</a>
            <a href="/new">Submit</a>
        </nav>
        
        <main>
            <a href="/athletes" class="back-link">‚Üê Back to Athletes</a>
            
            <div id="athlete-content" class="loading">
                Loading athlete profile...
            </div>
        </main>
    </div>

    <script>
        let athleteData = null;
        
        async function loadAthleteProfile() {
            const contentDiv = document.getElementById('athlete-content');
            const nameDiv = document.getElementById('athlete-name');
            
            // Get athlete name from URL path
            const pathParts = window.location.pathname.split('/');
            const athleteName = decodeURIComponent(pathParts[pathParts.length - 1]);
            
            if (!athleteName || athleteName === 'athlete.html') {
                contentDiv.innerHTML = '<div class="error">No athlete specified</div>';
                return;
            }
            
            try {
                // Load athlete data
                const athleteResponse = await fetch(`/api/athletes?name=${encodeURIComponent(athleteName)}`);
                const athletes = await athleteResponse.json();
                
                if (athletes.length === 0) {
                    contentDiv.innerHTML = '<div class="error">Athlete not found</div>';
                    return;
                }
                
                athleteData = athletes[0];
                nameDiv.textContent = athleteData.name;
                
                // Load athlete's ascents
                const ascentsResponse = await fetch(`/api/ascents?athlete_name=${encodeURIComponent(athleteName)}`);
                const ascents = await ascentsResponse.json();
                
                // Display athlete profile
                displayAthleteProfile(athleteData, ascents);
                
            } catch (error) {
                contentDiv.innerHTML = '<div class="error">Error loading athlete profile: ' + error.message + '</div>';
            }
        }
        
        function displayAthleteProfile(athlete, ascents) {
            const contentDiv = document.getElementById('athlete-content');
            
            // Calculate statistics
            const sportAscents = ascents.filter(a => a.climb_type === 'sport');
            const boulderAscents = ascents.filter(a => a.climb_type === 'boulder');
            const hardestSport = sportAscents.sort((a, b) => compareGrades(b.grade, a.grade, 'sport'))[0];
            const hardestBoulder = boulderAscents.sort((a, b) => compareGrades(b.grade, a.grade, 'boulder'))[0];
            
            contentDiv.innerHTML = `
                <div class="card">
                    <div class="profile-header">
                        <div class="profile-info">
                            <div class="profile-details">
                                ${athlete.nationality ? 'üè≥Ô∏è ' + athlete.nationality : ''}
                                ${athlete.gender ? ' ‚Ä¢ ' + athlete.gender : ''}
                                ${athlete.year_of_birth ? ' ‚Ä¢ Born ' + athlete.year_of_birth : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${ascents.length}</div>
                            <div class="stat-label">Total Ascents</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${sportAscents.length}</div>
                            <div class="stat-label">Sport Climbs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${boulderAscents.length}</div>
                            <div class="stat-label">Boulders</div>
                        </div>
                        ${hardestSport ? `
                        <div class="stat-card">
                            <div class="stat-number">${hardestSport.grade}</div>
                            <div class="stat-label">Hardest Sport</div>
                        </div>
                        ` : ''}
                        ${hardestBoulder ? `
                        <div class="stat-card">
                            <div class="stat-number">${hardestBoulder.grade}</div>
                            <div class="stat-label">Hardest Boulder</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${ascents.length > 0 ? `
                <div class="mb-30">
                    <h2 class="section-title">Notable Ascents</h2>
                    <div class="grid">
                        ${ascents.map(ascent => `
                            <div class="card">
                                <div class="climb-name">${ascent.climb_name}</div>
                                <div class="text-muted mb-10">
                                    <span class="grade-badge ${ascent.climb_type}-badge">${ascent.grade}</span>
                                    ${ascent.climb_type === 'sport' ? 'Sport' : 'Boulder'}
                                    ${ascent.location ? ' ‚Ä¢ ' + ascent.location : ''}
                                    ${ascent.date_of_ascent ? ' ‚Ä¢ ' + new Date(ascent.date_of_ascent).getFullYear() : ''}
                                </div>
                                <a href="/${ascent.climb_type}/${encodeURIComponent(ascent.climb_name)}" class="link">View Climb ‚Üí</a>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        function compareGrades(grade1, grade2, type) {
            // Simple grade comparison - could be enhanced with proper grade scales
            return grade1.localeCompare(grade2);
        }
        
        // Load athlete profile when page loads
        document.addEventListener('DOMContentLoaded', loadAthleteProfile);
    </script>
</body>
</html>