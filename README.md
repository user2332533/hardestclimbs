# Hardest Climbs

A simple, dependency-free website tracking the hardest sport climbs and boulder problems in the world, built with Cloudflare Pages and D1.

## Project Structure

```
├── public/                 # Static HTML files
│   └── index.html         # Main homepage
├── functions/             # Cloudflare Pages Functions
│   └── _worker.js        # Main API handler
├── schema.sql            # Database schema
├── migrate.py            # Data migration script
├── migrate_*.sql          # Generated migration files
├── inputs/                # Source JSON data
│   ├── boulder.json      # Boulder problems data
│   └── lead.json         # Sport climbs data
└── wrangler.toml         # Cloudflare configuration
```

## Features

- **Main page**: Top 10 hardest climbs (sport + boulder)
- **Sport climbs page**: All sport climbs
- **Boulders page**: All boulder problems  
- **Athletes page**: All climbers
- **Individual pages**: Detailed climb and athlete info
- **Submission system**: Add new climbs/athletes
- **Review workflow**: Password-protected admin review
- **Data export**: CSV dumps of all data

## Tech Stack

- **Frontend**: Vanilla HTML/CSS/JavaScript (no frameworks)
- **Backend**: Cloudflare Pages Functions
- **Database**: Cloudflare D1 (SQLite)
- **Deployment**: Cloudflare Pages

## Database Schema

Uses composite primary keys with versioning for data integrity:
- `athletes`: name, record_created (PK), nationality, gender, year_of_birth, status, hash
- `climbs`: name, record_created (PK), climb_type, grade, location fields, status, hash
- `ascents`: climb_name, athlete_name, record_created (PK), date_of_ascent, web_link, status, hash

- **Status values**: `valid`, `pending`, `rejected`
- **Hashes**: UUIDs for review system
- **Versioning**: Latest valid record selected by CTEs with ROW_NUMBER()
- **Indexes**: Optimized for name-based lookups and performance

## API Endpoints

- `GET /api/climbs?type=sport|boulder&limit=N` - Get climbs with filtering
- `GET /api/athletes` - Get all athletes
- `GET /api/ascents?climb=name&athlete=name` - Get ascents with filtering

All queries use CTEs with window functions to return exactly one row per entity, even with timestamp ties.

## Data Migration

The project includes 161 existing climbs (82 boulder, 79 sport) with 409 ascents across 129 athletes:

1. **Run migration script**: `python3 migrate.py`
2. **Generated SQL files**:
   - `migrate_athletes.sql` - 129 athletes
   - `migrate_climbs.sql` - 161 climbs
   - `migrate_ascents.sql` - 409 ascents

3. **Execute migrations** in D1 database:
   ```sql
   -- First create schema
   \i schema.sql
   
   -- Then populate data
   \i migrate_athletes.sql
   \i migrate_climbs.sql
   \i migrate_ascents.sql
   ```

## Getting Started

1. Create D1 databases in Cloudflare dashboard
2. Update `wrangler.toml` with your database IDs
3. Create schema: `wrangler d1 execute climbing-db --file=schema.sql`
4. Populate data: Run migration scripts generated by `python3 migrate.py`
5. Deploy to Cloudflare Pages

## Development

No build steps, no dependencies, no complexity - just simple files that work. The migration script handles proper SQL escaping for all string fields including names with apostrophes.